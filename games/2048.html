<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2048 Game - a2.games</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="../images/logo.png">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            color: white;
            text-align: center;
        }
        header {
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            font-size: 28px;
            font-weight: bold;
            letter-spacing: 1px;
            text-transform: lowercase;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        .container {
            max-width: 600px;
            margin: auto;
            padding: 50px 20px;
        }
        #game-canvas {
            margin: 30px auto;
            display: block;
            background: #faf8ef;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .footer {
            margin-top: 50px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.9);
        }
        .back-link {
            color: #ff9800;
            text-decoration: none;
            font-weight: bold;
            display: inline-block;
            margin-top: 20px;
        }
        .reset-btn {
            background: #ff9800;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 10px 24px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 10px;
        }
        #game-canvas {
            max-width: 30vw;
            max-height: 30vw;
        }
        @media (max-width: 720px) {
            #game-canvas {
                max-width: 90vw !important;
                max-height: 90vw !important;
                touch-action: none;
            }
        }
    </style>
</head>
<body>
    <header>
        <img src="./images/logo.png" width="96" height="96" alt="A2 games logo"><br>
        a2.games
    </header>
    <div class="container">
        <h1>2048</h1>
        <p>Join the numbers and get to the 2048 tile!</p>
        <button class="reset-btn" onclick="resetGame()">Restart</button>
        <canvas id="game-canvas" width="1000" height="1000"></canvas>
        <a href="index.html" class="back-link">&larr; Back to Home</a>
    </div>
    <div class="footer">
        &copy; 2025 A2 Games. All rights reserved.
    </div>
    <script>
        const size = 4;
        let board, score, gameOver;
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');

        window.addEventListener("keydown", function(e) {
        if (["Space", "ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight"].indexOf(e.code) > -1) {
            e.preventDefault(); // Prevent the default browser action (scrolling)
        }
        }, false);
        function resetGame() {
            board = Array(size).fill().map(() => Array(size).fill(0));
            score = 0;
            gameOver = false;
            addRandomTile();
            addRandomTile();
            draw();
        }

        function addRandomTile() {
            let empty = [];
            for (let r = 0; r < size; r++)
                for (let c = 0; c < size; c++)
                    if (board[r][c] === 0) empty.push([r, c]);
            if (empty.length === 0) return;
            let [r, c] = empty[Math.floor(Math.random() * empty.length)];
            board[r][c] = Math.random() < 0.9 ? 2 : 4;
        }

        function slide(row) {
            let arr = row.filter(val => val);
            for (let i = 0; i < arr.length - 1; i++) {
                if (arr[i] === arr[i + 1]) {
                    arr[i] *= 2;
                    score += arr[i];
                    arr[i + 1] = 0;
                }
            }
            arr = arr.filter(val => val);
            while (arr.length < size) arr.push(0);
            return arr;
        }

        function rotateLeft(matrix) {
            return matrix[0].map((_, i) => matrix.map(row => row[i])).reverse();
        }

        function move(dir) {
            let oldBoard = JSON.stringify(board);
            for (let i = 0; i < dir; i++) board = rotateLeft(board);
            for (let r = 0; r < size; r++) board[r] = slide(board[r]);
            for (let i = dir; i < 4; i++) board = rotateLeft(board);
            if (JSON.stringify(board) !== oldBoard) {
                addRandomTile();
                draw();
                if (isGameOver()) {
                    gameOver = true;
                    draw();
                }
            }
        }

        function isGameOver() {
            for (let r = 0; r < size; r++)
                for (let c = 0; c < size; c++)
                    if (board[r][c] === 0) return false;
            for (let r = 0; r < size; r++)
                for (let c = 0; c < size - 1; c++)
                    if (board[r][c] === board[r][c + 1]) return false;
            for (let c = 0; c < size; c++)
                for (let r = 0; r < size - 1; r++)
                    if (board[r][c] === board[r + 1][c]) return false;
            return true;
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Score
            ctx.font = `bold ${canvas.width / 25}px Poppins`;
            ctx.fillStyle = "#333";
            ctx.textAlign = "center";
            ctx.textBaseline = "top";
            ctx.fillText(`Score: ${score}`, canvas.width / 2, 10);

            // Board alignment
            const tileSize = canvas.width / 4.6;
            const gap = 10;
            const boardSize = size * tileSize + (size - 1) * gap;
            const offsetX = (canvas.width - boardSize) / 2;
            const offsetY = 50;

            for (let r = 0; r < size; r++) {
                for (let c = 0; c < size; c++) {
                    let val = board[r][c];
                    let x = offsetX + c * (tileSize + gap);
                    let y = offsetY + r * (tileSize + gap);

                    // Tile background
                    ctx.fillStyle = val ? `hsl(${200 + val}, 70%, 80%)` : "#ccc";
                    ctx.strokeStyle = "#bbb";
                    ctx.lineWidth = 2;
                    roundRect(ctx, x, y, tileSize, tileSize, 10, true, true);

                    // Tile number
                    if (val) {
                        ctx.fillStyle = "#222";
                        ctx.font = `bold ${tileSize / 4}px Poppins`;
                        ctx.textAlign = "center";
                        ctx.textBaseline = "middle";
                        ctx.fillText(val, x + tileSize / 2, y + tileSize / 2);
                    }
                }
            }

            // Game Over
            if (gameOver) {
                ctx.fillStyle = "rgba(0,0,0,0.7)";
                roundRect(ctx, offsetX, offsetY + boardSize / 2 - 30, boardSize, 60, 10, true, false);
                ctx.fillStyle = "#fff";
                ctx.font = "bold 32px Poppins";
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.fillText("Game Over!", canvas.width / 2, offsetY + boardSize / 2);
            }
        }

        // Helper for rounded rectangles
        function roundRect(ctx, x, y, w, h, r, fill, stroke) {
            ctx.beginPath();
            ctx.moveTo(x + r, y);
            ctx.lineTo(x + w - r, y);
            ctx.quadraticCurveTo(x + w, y, x + w, y + r);
            ctx.lineTo(x + w, y + h - r);
            ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
            ctx.lineTo(x + r, y + h);
            ctx.quadraticCurveTo(x, y + h, x, y + h - r);
            ctx.lineTo(x, y + r);
            ctx.quadraticCurveTo(x, y, x + r, y);
            ctx.closePath();
            if (fill) ctx.fill();
            if (stroke) ctx.stroke();
        }

        // Keyboard controls
        window.addEventListener('keydown', e => {
            if (gameOver) return;
            if (e.key === 'ArrowLeft') move(0);
            if (e.key === 'ArrowUp') move(1);
            if (e.key === 'ArrowRight') move(2);
            if (e.key === 'ArrowDown') move(3);
        });

        // Touch controls for mobile
        let startX, startY;
        canvas.addEventListener('touchstart', e => {
            let t = e.touches[0];
            startX = t.clientX; startY = t.clientY;
        });
        canvas.addEventListener('touchend', e => {
            let t = e.changedTouches[0];
            let dx = t.clientX - startX;
            let dy = t.clientY - startY;
            if (gameOver) return;
            if (Math.abs(dx) > Math.abs(dy)) {
                if (dx > 30) move(2); // right
                else if (dx < -30) move(0); // left
            } else {
                if (dy > 30) move(3); // down
                else if (dy < -30) move(1); // up
            }
        });

        // Start game
        resetGame();
    </script>
</body>
</html>
